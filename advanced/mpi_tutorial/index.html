
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../openmp_tutorial/">
      
      
        <link rel="next" href="../job_array/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.19">
    
    
      
        <title>Tutorial de MPI - Tutoriais do NPAD</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#passo-1-conexao-ao-supercomputador-por-ssh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tutoriais do NPAD" class="md-header__button md-logo" aria-label="Tutoriais do NPAD" data-md-component="logo">
      
  <img src="../../assets/logo_npad.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tutoriais do NPAD
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial de MPI
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/NPAD-UFRN/Tutorials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tutoriais do NPAD" class="md-nav__button md-logo" aria-label="Tutoriais do NPAD" data-md-component="logo">
      
  <img src="../../assets/logo_npad.png" alt="logo">

    </a>
    Tutoriais do NPAD
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NPAD-UFRN/Tutorials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Início
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Iniciante
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Iniciante
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/superpc_introduction_part_1/" class="md-nav__link">
        Introdução ao supercomputador - Parte&nbsp;1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/superpc_introduction_part_2/" class="md-nav__link">
        Introdução ao supercomputador - Parte&nbsp;2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/gnome_files/" class="md-nav__link">
        Copiando arquivos através de uma interface gráfica Gnome Files (linux)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/winscp_tutorial/" class="md-nav__link">
        Copiando arquivos através de uma interface gráfica WinSCP (Windows)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/scp_tutorial/" class="md-nav__link">
        Tutorial do scp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/rsync_tutorial/" class="md-nav__link">
        Tutorial do rsync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/putty_tutorial/" class="md-nav__link">
        Tutorial do PuTTy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/mobaxterm_tutorial/" class="md-nav__link">
        Tutorial do MobaXterm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Intermediário
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Intermediário
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/superpc_introduction_part_3/" class="md-nav__link">
        Introdução ao supercomputador - Parte&nbsp;3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/slurm_commands/" class="md-nav__link">
        Comandos do supercomputador
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/gpu/" class="md-nav__link">
        Uso da GPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/install_apps/" class="md-nav__link">
        Instalação de programas no supercomputador
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/conda/" class="md-nav__link">
        Tutorial do Conda (miniconda ou Anaconda)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Avançado
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Avançado
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openmp_tutorial/" class="md-nav__link">
        Tutorial de OpenMP
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tutorial de MPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tutorial de MPI
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passo-1-conexao-ao-supercomputador-por-ssh" class="md-nav__link">
    Passo 1: Conexão ao supercomputador por SSH
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-2-criacao-de-um-programa-mpi" class="md-nav__link">
    Passo 2: Criação de um programa MPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-3-compilacao-do-programa-mpi" class="md-nav__link">
    Passo 3: Compilação do programa MPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-4-execucao-do-programa-no-supercomputador" class="md-nav__link">
    Passo 4: Execução do programa no supercomputador
  </a>
  
    <nav class="md-nav" aria-label="Passo 4: Execução do programa no supercomputador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exemplo-de-script-mais-simples" class="md-nav__link">
    Exemplo de script mais simples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplo-de-script-mais-detalhado" class="md-nav__link">
    Exemplo de script mais detalhado
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../job_array/" class="md-nav__link">
        Tutorial de Job Array
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tch-rs_tutorial/" class="md-nav__link">
        tch-rs-example MNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jupyter_tutorial/" class="md-nav__link">
        Usando o Jupyter no supercomputador
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passo-1-conexao-ao-supercomputador-por-ssh" class="md-nav__link">
    Passo 1: Conexão ao supercomputador por SSH
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-2-criacao-de-um-programa-mpi" class="md-nav__link">
    Passo 2: Criação de um programa MPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-3-compilacao-do-programa-mpi" class="md-nav__link">
    Passo 3: Compilação do programa MPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-4-execucao-do-programa-no-supercomputador" class="md-nav__link">
    Passo 4: Execução do programa no supercomputador
  </a>
  
    <nav class="md-nav" aria-label="Passo 4: Execução do programa no supercomputador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exemplo-de-script-mais-simples" class="md-nav__link">
    Exemplo de script mais simples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplo-de-script-mais-detalhado" class="md-nav__link">
    Exemplo de script mais detalhado
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="tutorial-de-mpi">Tutorial de MPI<a class="headerlink" href="#tutorial-de-mpi" title="Permanent link">&para;</a></h1>
<p>Nesse tutorial iremos aprender a conduzir a execução de aplicações utilizando o Intel MPI no supercomputador, uma das melhores implementações MPI da indústria, de maneira simples e prática.</p>
<p>O MPI é um padrão de troca de mensagens para uso em computação paralela, oferecendo uma infraestrutura para a criação de programas que utilizem recursos de CPU e memória de múltiplos computadores em um cluster ou nós em um supercomputador, além de permitir a passagem coordenada de mensagens entre processos.</p>
<p>Definindo um padrão industrial para a troca de mensagens, existem diversas implementações do MPI. Iremos utilizar o Intel MPI juntamente com o gerenciador de recursos SLURM de acordo com os passos a seguir:</p>
<ol>
<li>Conexão ao supercomputador por SSH</li>
<li>Criação de um programa MPI</li>
<li>Compilação do programa MPI</li>
<li>Execução do programa no supercomputador</li>
</ol>
<h2 id="passo-1-conexao-ao-supercomputador-por-ssh">Passo 1: Conexão ao supercomputador por SSH<a class="headerlink" href="#passo-1-conexao-ao-supercomputador-por-ssh" title="Permanent link">&para;</a></h2>
<p>Para se conectar ao supercomputador é necessário utilizar o SSH já disponível por padrão na maioria dos sistemas Unix como nas distribuições Linux e todas as versões do Mac OS X assim como disponível livremente na Internet como download para a plataforma Windows. O cliente SSH mais popular da plataforma Windows é o <a href="../../beginner/putty_tutorial/">Putty</a></p>
<p>Iremos nesse tutorial utilizar como padrão a plataforma Linux, mas sua execução no Windows segue os mesmos princípios.</p>
<p>Para se conectar no nó de login do supercomputador basta executar o seguinte comando:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">4422</span><span class="w"> </span>USUARIO@sc2.npad.ufrn.br
</code></pre></div>
<p>Troque <strong>USUARIO</strong> pelo seu nome de usuário já autorizado. Você deve visualizar uma tela com notícias sobre o supercomputador e a criação dos seus diretórios pessoais.</p>
<p>Nesse momento você já está conectado ao supercomputador no ambiente Linux da máquina em sua área pessoal de arquivos. Todos os comandos padrão da distribuição CentOS assim como alguns editores de texto como o 'Emacs' e 'Vi' estão disponíveis para que você possa manipular seus arquivos e pastas pessoais. Nesse momento você já está conectado ao supercomputador no ambiente Linux da máquina em sua área pessoal de arquivos. Todos os comandos padrão da distribuição CentOS assim como alguns editores de texto como o 'Emacs' e 'Vi' estão disponíveis para que você possa manipular seus arquivos e pastas pessoais.</p>
<h2 id="passo-2-criacao-de-um-programa-mpi">Passo 2: Criação de um programa MPI<a class="headerlink" href="#passo-2-criacao-de-um-programa-mpi" title="Permanent link">&para;</a></h2>
<p>O esqueleto de um programa MPI é estruturado da seguinte forma:</p>
<ul>
<li>Inclusão do cabeçalho mpi.h e dos demais cabeçalhos necessários ao programa</li>
<li>Início do programa indicado pela linha de código "int main (int argc, char *argv[])"</li>
<li>Código sequencial opcional, por exemplo: inicialização de variáveis</li>
<li>Inicialização do código paralelo indicado pela linha de código "MPI_Init(&amp;argc, &amp;argv);"</li>
<li>Leitura da quantidade de processos criados indicado pela linha de código "MPI_Comm_size(MPI_COMM_WORLD, &amp;comm_sz);"</li>
<li>Leitura do rank do processo utilizado, indicado pela linha de código "MPI_Comm_rank(MPI_COMM_WORLD, &amp;comm_sz);"</li>
<li>Código paralelo</li>
<li>Finalização do código paralelo indicado pela linha de código "MPI_Finalize();"</li>
<li>Código sequencial opcional e finalização do programa</li>
</ul>
<p>Um exemplo de programa MPI é ilustrado abaixo. Copie esse programa para um arquivo na sua pasta pessoal e salve com o nome "mpi_hello.c". A função desse programa é imprimir uma mensagem de forma paralela a partir de processos diferentes. Esses processos podem estar no mesmo nó, utilizando diferentes núcleos, ou podem estar em nós diferentes. Essa escolha é feita pelo usuário a partir dos parâmetros utilizados no script de submissão que será mostrado numa seção (ou passo) posterior.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mpi.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w">  </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">comm_sz</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">hostname</span><span class="p">[</span><span class="n">MPI_MAX_PROCESSOR_NAME</span><span class="p">];</span>

<span class="w">  </span><span class="n">MPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="n">MPI_Comm_size</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">comm_sz</span><span class="p">);</span>
<span class="w">  </span><span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span>

<span class="w">  </span><span class="n">MPI_Get_processor_name</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello from process %d on node %s!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">hostname</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;From process %d: Number of MPI processes is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">comm_sz</span><span class="p">);</span>

<span class="w">  </span><span class="n">MPI_Finalize</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="passo-3-compilacao-do-programa-mpi">Passo 3: Compilação do programa MPI<a class="headerlink" href="#passo-3-compilacao-do-programa-mpi" title="Permanent link">&para;</a></h2>
<p>De posse do arquivo <code>mpi_hello.c</code>, você pode compilar o mesmo com o comando “mpiicc” da seguinte forma:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mpiicc<span class="w"> </span>mpi_hello.c<span class="w"> </span>-o<span class="w"> </span>mpi_hello<span class="w"> </span>
$<span class="w"> </span>ls<span class="w"> </span>
mpi_hello.c<span class="w">   </span>mpi_hello
</code></pre></div>
<p>A compilação gerou com sucesso o arquivo binário “mpi_hello” que será executado em vários núcleos de processadores do supercomputador no próximo passo.</p>
<h2 id="passo-4-execucao-do-programa-no-supercomputador">Passo 4: Execução do programa no supercomputador<a class="headerlink" href="#passo-4-execucao-do-programa-no-supercomputador" title="Permanent link">&para;</a></h2>
<p>No supercomputador é utilizado o gerenciador de recursos SLURM para se executar tarefas em diversos processadores da máquina. Tradicionalmente usuários do MPI utilizam o comando “mpirun” ou “mpiexec”, mas no nosso ambiente iremos utilizar o SLURM com o comando “sbatch” que recebe um script bash contendo configurações específicas sobre os recursos desejados, assim como que programa será executado pela sua tarefa. Esse script é chamado oficialmente de “Job submission file”.</p>
<h3 id="exemplo-de-script-mais-simples">Exemplo de script mais simples<a class="headerlink" href="#exemplo-de-script-mais-simples" title="Permanent link">&para;</a></h3>
<p>Para executar 4 tarefas do programa “mpi_hello” devemos criar um script chamado, por exemplo, de “jobMPI.sh” com o conteúdo abaixo:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --partition=amd-512 #partição para a qual o job é enviado</span>

srun<span class="w"> </span>--time<span class="o">=</span><span class="m">0</span>-0:5<span class="w"> </span>-n4<span class="w"> </span>mpi_hello
</code></pre></div>
<p>Para enviar esse “job” para a fila de execução usamos o comando:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sbatch<span class="w"> </span>jobMPI.sh<span class="w"> </span>

Submitted<span class="w"> </span>batch<span class="w"> </span>job<span class="w"> </span><span class="m">2230</span>
</code></pre></div>
<p>Esse comando irá adicionar o “job” na fila de execução e retornar um id (nesse caso 2230) dessa nova tarefa adicionada. Para monitorar a tarefa você pode usar o comando <code>squeue</code> para visualizar todas as tarefas em andamento. Se desejar cancelar uma tarefa em execução utilize o comando <code>scancel JOB_ID</code>.</p>
<p>Ao finalizar sua execução o SLURM cria automaticamente um arquivo chamado “slurm-JOB_ID.out” com a saída padrão de sua tarefa redirecionada para esse arquivo. O nome do arquivo contém o ID do job enviado (JOB_ID) para facilitar sua relação com o mesmo. Isso é importante se seu programa gera uma saída padrão que contém um resultado útil da sua execução. Veja abaixo o resultado da execução do simples script que criamos e sua saída em arquivos:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sbatch<span class="w"> </span>jobMPI.sh<span class="w"> </span>

Submitted<span class="w"> </span>batch<span class="w"> </span>job<span class="w"> </span><span class="m">2230</span>

$<span class="w"> </span>cat<span class="w"> </span>slurm-2230.out<span class="w"> </span>

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">3</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i2n16!

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">2</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i2n16!

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">1</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i2n16!

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">0</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i2n16!

From<span class="w"> </span>process<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>MPI<span class="w"> </span>processes<span class="w"> </span>is<span class="w"> </span><span class="m">4</span>
</code></pre></div>
<p>Repare que todas as 4 tarefas foram executadas no mesmo nó (neste caso o r1i2n16), pois o SLURM só foi instruído para executar 4 tarefas e nada mais.</p>
<h3 id="exemplo-de-script-mais-detalhado">Exemplo de script mais detalhado<a class="headerlink" href="#exemplo-de-script-mais-detalhado" title="Permanent link">&para;</a></h3>
<p>Um exemplo de script que solicita que 4 tarefas do programa “mpi_hello” executem em 2 nós diferentes é mostrado abaixo:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --job-name=MPI_hello  </span>
<span class="c1">#SBATCH --output=saida%j.out</span>
<span class="c1">#SBATCH --error=erro%j.err</span>
<span class="c1">#SBATCH --partition=amd-512</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --ntasks-per-node=2</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --time=0-0:5</span>

srun<span class="w"> </span>mpi_hello
</code></pre></div>
<p>Repare que agora o script contém vários parâmetros que foram adicionados. A descrição desses parâmetros é informada abaixo:</p>
<ul>
<li><code>job-name</code>: Nome que aparecerá na fila de jobs</li>
<li><code>output</code>: Arquivo de saída padrão do programa</li>
<li><code>error</code>: Arquivo de saída de erro do programa</li>
<li><code>nodes</code>: Quantidade de nós alocados para o programa</li>
<li><code>ntasks-per-node</code>: Número de processos em um mesmo nó (normalmente 1 para jobs OpenMP) - Útil para jobs MPI</li>
<li><code>cpus-per-task</code>: Número de núcleos de CPU alocados para um processo do programa</li>
<li><code>time</code>: Tempo máximo para execução do job (nesse exemplo = 5 min). Caso o job ainda não tenha terminado, após esse tempo ele será cancelado. Formato: dias-horas:minutos</li>
</ul>
<p>Observa-se, então, que foram requisitados 2 (valor de --nodes) nós para os jobs e que em cada nó serão criados 2 (valor de --ntasks-per-node) processos. O comando “srun mpi_hello” agora não deve mais conter o número de tarefas que será executada, uma vez que isso já está definido anteriormente no script. Veja sua execução:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sbatch<span class="w"> </span>jobMPI.sh<span class="w"> </span>

Submitted<span class="w"> </span>batch<span class="w"> </span>job<span class="w"> </span><span class="m">2236</span>

<span class="o">[</span>seuUsuario@service0<span class="w"> </span>~<span class="o">]</span>$<span class="w">  </span>cat<span class="w"> </span>slurm-2236.out<span class="w"> </span>

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">3</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i1n2!

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">2</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i1n2!

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">1</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i3n5!

Hello<span class="w"> </span>from<span class="w"> </span>process<span class="w"> </span><span class="m">0</span><span class="w"> </span>on<span class="w"> </span>node<span class="w"> </span>r1i3n5!

From<span class="w"> </span>process<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>MPI<span class="w"> </span>processes<span class="w"> </span>is<span class="w"> </span><span class="m">4</span>
</code></pre></div>
<p>Repare que agora as 4 tarefas foram executadas em dois nós distintos (r1i1n2 e r1i3n5), exatamente da forma que instruímos.</p>
<p>Assim finalizamos nosso tutorial Intel MPI. Para mais informações sobre o Intel MPI e o SLURM acesse os links abaixo:</p>
<ul>
<li><a href="http://slurm.schedmd.com/">http://slurm.schedmd.com/</a></li>
<li><a href="https://software.intel.com/en-us/intel-mpi-library">https://software.intel.com/en-us/intel-mpi-library</a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "navigation.sections", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>